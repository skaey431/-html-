<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CCTV 관리</title>
    <style>
        table, th, td { border:1px solid black; border-collapse: collapse; padding:5px; text-align:center; }
        th { background:#eee; }
        input[type="text"] { width:100px; }
        input[type="checkbox"] { transform: scale(1.2); }
        button { margin-top:10px; padding:5px 10px; }
    </style>
</head>
<body>
<h2>CCTV 근무자 관리</h2>

<table id="cctvTable">
    <thead>
    <tr>
        <th>구분</th>
        <th colspan="4">칸</th>
    </tr>
    </thead>
    <tbody>
    <tr id="dayRow">
        <td>주간</td>
    </tr>
    <tr id="nightRow">
        <td>야간</td>
    </tr>
    </tbody>
</table>

<button onclick="saveData()">저장</button>

<script>
    const SLOT_COUNT = 8;
    const STORAGE_KEY = "cctvData";

    // 초기 생성
    function initTable() {
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

        const dayRow = document.getElementById("dayRow");
        const nightRow = document.getElementById("nightRow");

        for(let i=0;i<4;i++){
            const data = saved[i] || {active:false, name:""};
            const td = createCell(data);
            dayRow.appendChild(td);
        }

        for(let i=4;i<8;i++){
            const data = saved[i] || {active:false, name:""};
            const td = createCell(data);
            nightRow.appendChild(td);
        }
    }

    // 셀 생성
    function createCell(data) {
        const td = document.createElement("td");
        td.innerHTML = `
    <input type="checkbox" ${data.active?'checked':''} onchange="onCheckChange(this)">
    <br>
    <input type="text" value="${data.name}" placeholder="이름" ${data.active?'':'disabled'}>
  `;
        return td;
    }

    // 체크박스 이벤트
    function onCheckChange(checkbox){
        const input = checkbox.parentElement.querySelector("input[type=text]");
        input.disabled = !checkbox.checked;
        if(!checkbox.checked) input.value = "";
    }

    // 저장
    function saveData() {
        const rows = document.querySelectorAll("#cctvTable tbody tr:not(:first-child)"); // dayRow, nightRow
        const data = [];
        rows.forEach(row => {
            const cells = row.querySelectorAll("td:not(:first-child)");
            cells.forEach(td => {
                const checkbox = td.querySelector("input[type=checkbox]");
                const input = td.querySelector("input[type=text]");
                data.push({active: checkbox.checked, name: input.value});
            });
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        alert("저장 완료!");
    }

    initTable();
</script>
</body>
</html>
