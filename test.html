<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>점호 열외 관리</title>
    <style>
        table, th, td { border:1px solid black; border-collapse: collapse; padding:5px; text-align:center; }
        th { background:#eee; }
        select, input[type="text"] { width:150px; }
    </style>
</head>
<body>
<h2>점호 열외 입력</h2>
<table id="inputTable">
    <thead>
    <tr>
        <th>이름</th>
        <th>열외 구분</th>
        <th>열외 사유</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>
<button onclick="addRow()">행 추가</button>
<button onclick="makeSummary()">집계표 생성</button>

<h2>집계표</h2>
<table id="summaryTable">
    <thead>
    <tr>
        <th>열외 사유</th>
        <th>명수</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const STORAGE_KEY = "attendanceExclusion";

    // 행 추가
    function addRow(name="", type="저녁 점호 열외", reason="") {
        const tbody = document.querySelector("#inputTable tbody");
        const tr = document.createElement("tr");
        tr.innerHTML = `
    <td><input type="text" value="${name}" placeholder="이름" oninput="saveData()"></td>
    <td>
      <select onchange="saveData()">
        <option ${type==='저녁 점호 열외'?'selected':''}>저녁 점호 열외</option>
        <option ${type==='아침 점호 열외'?'selected':''}>아침 점호 열외</option>
      </select>
    </td>
    <td><input type="text" value="${reason}" placeholder="열외 사유" oninput="saveData()"></td>
  `;
        tbody.appendChild(tr);
    }

    // 저장
    function saveData() {
        const rows = [...document.querySelectorAll("#inputTable tbody tr")];
        const data = rows.map(row => ({
            name: row.querySelector("td:nth-child(1) input").value,
            type: row.querySelector("td:nth-child(2) select").value,
            reason: row.querySelector("td:nth-child(3) input").value
        }));
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // 불러오기
    function loadData() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if(!saved) { addRow(); return; }
        const data = JSON.parse(saved);
        data.forEach(item => addRow(item.name, item.type, item.reason));
    }

    // 집계
    function makeSummary() {
        const rows = document.querySelectorAll("#inputTable tbody tr");
        const summary = {};

        rows.forEach(row => {
            const reason = row.querySelector("td:nth-child(3) input").value.trim();
            if(!reason) return;
            if(!summary[reason]) summary[reason] = 0;
            summary[reason]++;
        });

        const tbody = document.querySelector("#summaryTable tbody");
        tbody.innerHTML = "";
        for(let reason in summary) {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${reason}</td><td>${summary[reason]}</td>`;
            tbody.appendChild(tr);
        }
    }

    // 초기 로드
    loadData();
</script>
</body>
</html>
