<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>용사 신상 관리</title>
    <style>
        table, th, td { border:1px solid black; border-collapse: collapse; padding:5px; text-align:center; }
        th { background:#eee; }
        input[type="text"], input[type="number"] { width:100px; }
        button { margin:5px; padding:5px 10px; }

        /* 모달 스타일 */
        .modal {
            display:none;
            position:fixed;
            z-index:1000;
            left:0; top:0;
            width:100%; height:100%;
            background-color: rgba(0,0,0,0.5);
            justify-content:center;
            align-items:center;
        }
        .modal-content {
            background:white;
            padding:20px;
            border-radius:5px;
            max-height: 80%;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<h2>메인 페이지</h2>

<!-- 용사 신상 관리 버튼 -->
<button onclick="openSoldierModal()">용사 신상 관리</button>

<h3>용사 목록</h3>
<table id="soldierSummary">
    <thead>
    <tr>
        <th>이름</th>
        <th>중대</th>
        <th>입대 년/월</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- 모달 -->
<div id="soldierModal" class="modal">
    <div class="modal-content">
        <h3>용사 신상 관리</h3>
        <table id="soldierTable">
            <thead>
            <tr>
                <th>이름</th>
                <th>중대</th>
                <th>입대 년</th>
                <th>입대 월</th>
                <th>삭제</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button onclick="addSoldierRow()">행 추가</button>
        <button onclick="saveSoldiers()">저장 후 닫기</button>
    </div>
</div>

<script>
    const STORAGE_KEY = "soldierData";

    /* 모달 열기 */
    function openSoldierModal() {
        document.getElementById("soldierModal").style.display = "flex";
        loadSoldiers();
    }

    /* 모달 닫기 */
    function closeSoldierModal() {
        document.getElementById("soldierModal").style.display = "none";
    }

    /* 저장 후 모달 닫기 */
    function saveSoldiers() {
        const rows = document.querySelectorAll("#soldierTable tbody tr");
        const data = [];
        rows.forEach(row => {
            const cells = row.querySelectorAll("td input");
            const name = cells[0].value.trim();
            const unit = cells[1].value.trim();
            const year = parseInt(cells[2].value);
            const month = parseInt(cells[3].value);
            if(name !== "") {
                data.push({name, unit, enlistYear:year, enlistMonth:month});
            }
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        closeSoldierModal();
        renderSoldierSummary();
    }

    /* 로드 */
    function loadSoldiers() {
        const tbody = document.querySelector("#soldierTable tbody");
        tbody.innerHTML = "";
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        saved.forEach(soldier => {
            tbody.appendChild(createSoldierRow(soldier));
        });
    }

    /* 테이블 행 생성 */
    function createSoldierRow(data={name:"",unit:"",enlistYear:"",enlistMonth:""}){
        const tr = document.createElement("tr");
        tr.innerHTML = `
    <td><input type="text" value="${data.name}"></td>
    <td><input type="text" value="${data.unit}"></td>
    <td><input type="number" value="${data.enlistYear}"></td>
    <td><input type="number" value="${data.enlistMonth}"></td>
    <td><button onclick="deleteSoldierRow(this)">삭제</button></td>
  `;
        return tr;
    }

    /* 행 추가 */
    function addSoldierRow() {
        const tbody = document.querySelector("#soldierTable tbody");
        tbody.appendChild(createSoldierRow());
    }

    /* 삭제 */
    function deleteSoldierRow(btn) {
        if(confirm("정말 삭제하시겠습니까?")) {
            const tr = btn.parentElement.parentElement;
            tr.remove();
        }
    }

    /* 메인 페이지 테이블 갱신 */
    function renderSoldierSummary(){
        const tbody = document.querySelector("#soldierSummary tbody");
        tbody.innerHTML = "";
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        saved.forEach(s => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${s.name}</td><td>${s.unit}</td><td>${s.enlistYear}/${s.enlistMonth}</td>`;
            tbody.appendChild(tr);
        });
    }

    /* 페이지 로드 시 초기화 */
    renderSoldierSummary();
</script>
</body>
</html>
